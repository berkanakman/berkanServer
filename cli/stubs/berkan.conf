#
# Berkan Default VirtualHost - Catch-all
# Managed by Berkan
#

<VirtualHost VALET_LOOPBACK:VALET_HTTP_PORT>
    ServerName berkan.localhost
    ServerAlias *
    DocumentRoot "VALET_SERVER_PATH"

    <Directory "VALET_SERVER_PATH">
        AllowOverride All
        Require all granted
        Options +FollowSymLinks +MultiViews
    </Directory>

    # PHP-FPM proxy via Unix socket
    <FilesMatch \.php$>
        SetHandler "proxy:unix:VALET_HOME_PATH/berkan.sock|fcgi://localhost"
    </FilesMatch>

    # Route all requests through server.php
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)/$ /$1 [R=301,L]
    RewriteCond %{REQUEST_URI} !(\.html|\.js|\.css|\.png|\.jpg|\.gif|\.ico)$
    RewriteRule ^ /server.php [L]

    # Security headers
    Header always set X-Content-Type-Options "nosniff"

    ErrorLog "VALET_HOME_PATH/Log/apache-error.log"
    CustomLog "VALET_HOME_PATH/Log/apache-access.log" common
</VirtualHost>
